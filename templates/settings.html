{% extends "base2.html" %}

{% block content %}
<div class="row justify-content-md-center mb-4">
  <h1 class="">{{myuser.username}} Settings</h1>
</div>

<div class="row justify-content-md-center">




<div class="col col-lg-8">
  <div class="card-body">

    <div class="circle" 
        style="width:100px; height:100px; border-radius:50%; overflow:hidden">
    <img src="https://upload.wikimedia.org/wikipedia/en/thumb/e/ed/Nyan_cat_250px_frame.PNG/220px-Nyan_cat_250px_frame.PNG" style="width:100%; height:100% object-fit:cover;">
    </div>
    
    <h3 class="card-title">Edit Profile</h3>
    <form id="edit-profile" method="post" action="/edit-profile">

      <div class="form-group">
        <p style="margin:5px">New Username:</p>
        <input class="form-control" type="text" id="tag-input" name="new-username" 
          placeholder="Enter new username here (optional)" style="max-width:300px">
      </div>

      <div class="form-group">
        <p style="margin:5px">New Password:</p>
        <input class="form-control" type="text" id="tag-input" name="new-password" 
          placeholder="Enter new password here (optional)" style="max-width:300px">
      </div>

      <h4 class="card-title">Submit Changes</h4>
      <p style="margin:5px">Password</p>
      <div class="form-group" style="display:flex;">
        <input class="form-control" type="text" name="password" 
            placeholder="Enter current password here (required)" style="max-width:300px">
        <button type="submit" class="btn btn-primary" 
            style="margin: 0 10px; max-width:300px;">Submit</button>
      </div>
      
      <!--div style="padding:10px 40px"><span id="file-text">test text</span></div-->
      
    </form>

    <form id="edit-profile" method="post" action="/delete-profile">
    </form>
    
  </div>
</div>


  
  <!--div class="col col-lg-8">
    <div class="card bg-light mb-3">
      <div class="card-body">
        <script src="{{ url_for('static', filename='upload.js') }}"></script>
        <script>
            function updateFileText(input, id) {
                const length = input.files.length;
                let text;
                
                if (length == 0) {
                    text = "No files selected.";
                } else if (length == 1) {
                    text = input.files[0].name;
                } else if (length >= 2) {
                    text = String(length) + " files selected.";
                }
                
                document.getElementById(id).textContent = text;
            }

            function upload_files(input_id, output_id) {
                return uploadFiles(input_id).then(data => {
                    if (data !== null) {
                        //console.log("data:")
                        //console.log(data);
                        let files = data.message;
                        let hashes = "";
                        for (let i = 0; i < files.length; i++) {
                            //console.log(files[i]);
                            hashes += files[i].hash;
                            if (i < files.length - 1)
                                hashes += ',';
                        }
                        document.getElementById(output_id).value = hashes;
                        return true;
                    } else {
                        document.getElementById(output_id).value = "{error}";
                        return false;
                    }
                })
            }

            //console.log(upload_files);

            function submit_form(form_id, file_input_id, file_output_id, error_id) {
                // this nested 'then' return scheme hell that I have been forced 
                // to comply with is why nobody likes javascript. Good lord.
                // TODO: if multiple upload file requests are made at once, 
                // it often causes the database to corrupt itself.
                // add some sort of atomic operation for this in flask.
                upload_files(file_input_id, file_output_id).then(ok => {
                    if (ok) {
                        document.getElementById(form_id).submit();
                    } else {
                        document.getElementById(error_id).textContent = 
                            "Error uploading files. (see console logs)";
                    }
                });
                //return false;
            }
        </script>
        <form id="post-form" method="post" action="/post">
          <div class="form-group">
            <textarea class="form-control" name="post" rows="3" 
              placeholder="What's on your mind?"></textarea>
          </div>
          <div class="form-group">
            <input class="form-control" type="text" id="tag-input" name="tags" 
              placeholder="Enter comma separated tags here">
          </div>
          <!--div style="padding:10px 40px"><span id="file-text">test text</span></div-\->
          <button type="submit" class="btn btn-primary" name="post-submit"
            onclick="event.preventDefault(); submit_form('post-form', 'file-upload', 'file-hashes', 'file-text')">Submit</button>
          <label class="btn btn-dark" for="file-upload" style="margin:0.375rem 0.5rem">Upload Files</label>
          <input type="file" id="file-upload" style="display:none;"
            onchange="updateFileText(this, 'file-text')" multiple>
          <span id="file-text"></span>
          <input id="file-hashes" name="files" style="display:none;">
        </form>
      </div>
    </div-->

    
  </div>



  </div>
{% endblock %}
